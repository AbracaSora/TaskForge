# 专家序列相关性较差时的训练改进方案

## 问题
专家序列之间相关性差，训练某一条对另一条帮助有限，验证集损失变化不明显。

## 方案

### 1. 批量训练（Batch Training）
- **目标**：每步从多条序列获取梯度，使更新更偏向通用结构
- **做法**：每步随机采样 `batch_size` 条训练序列，分别计算 loss 后求平均，再做一次 backward
- **参数**：`batch_size = 8`

### 2. 强化正则化
- **目标**：减轻过拟合单条序列，保持转移接近 NFA 先验
- **做法**：提高 `kl_lambda` 和 `entropy_coef`
- **参数**：`kl_lambda = 1.0`（原 0.5），`entropy_coef = 0.1`（原 0.05）

### 3. 数据增强（Data Augmentation）
- **目标**：在不破坏 NFA 合法性的前提下，增加训练序列的变体
- **做法**：
  - **Gu 插入**：随机选取若干位置，插入 "Gu"（Gu 可自环，合法）
  - **Gu 删除**：以一定概率删除序列中的 "Gu"
- **参数**：`aug_prob_insert = 0.1`，`aug_prob_delete = 0.2`

### 4. 训练流程
- 每个 epoch 开始可对训练序列做增强（按概率）
- 每个 step 随机采样 batch_size 条序列，执行 batch_train_step
- 每个 epoch 结束后在验证集上评估
